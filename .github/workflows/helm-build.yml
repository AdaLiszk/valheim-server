# =================================================================================================
name: "Helm Build"

# =================================================================================================
on:
  pull_request:
    paths:
      - .github/workflows/helm-build.yml
      - chart/**/*
      - chart/*
    types:
      - synchronize
      - opened
  push:
    paths:
      - .github/workflows/helm-build.yml
      - chart/**/*
      - chart/*
    branches:
      - develop
      - stable

# =================================================================================================
jobs:

  lint:
    runs-on: ubuntu-latest
    name: "Lint"
    steps:
      - name: "Checkout"
        uses: actions/checkout@v2

      - name: "Lint"
        uses: WyriHaximus/github-action-helm3@v2
        continue-on-error: true
        with:
          exec: helm lint ./chart

  bundle:
    needs: [ lint ]
    runs-on: ubuntu-latest
    name: "Bundle"
    steps:
      - name: "Checkout"
        uses: actions/checkout@v2

      - name: "Lint"
        uses: WyriHaximus/github-action-helm3@v2
        with:
          exec: helm package ./chart

      - name: "Upload Artifacts"
        uses: actions/upload-artifact@v2
        with:
          name: helm-package
          path: valheim-server-*.tgz

  push:
    needs: [ bundle ]
    runs-on: ubuntu-latest
    name: "Push"
    steps:
      - run: "exit 0"